# See https://circleci.com/docs/configuration
# Setup dependencies
machine:
  environment:
    MAP_SERVER_PORT: 9000
    RIDER_SERVER_PORT: 9100
    REPORT_SERVER_PORT: 9200

dependencies:
  override:
    - npm install
    - bower install

  post:
    - ./node_modules/protractor/bin/webdriver-manager update
#    - sudo apt-get install -y x11vnc
#    - x11vnc -forever -nopw:
#        background: true
#
#test:
#  pre:
#    - grunt build:
#        environment:
#          LOCAL: "1"
#    - grunt serve:
#        background: true
#    - ./node_modules/protractor/bin/webdriver-manager start:
#        background: true
#  override:
#    - ./node_modules/protractor/bin/protractor testing/conf.js

# Example of how to skip tests.
#test:
#  override:
#    - echo "test"

test:
  pre:
    - grunt serve:
        background: true
    - ./node_modules/protractor/bin/webdriver-manager start:
        background: true
  override:
    - ./node_modules/protractor/bin/protractor testing/conf.js

# Deploying to Surge
deployment:
  production:
    branch: master
    commands:
      - npm install -g surge
      - surge ./map raspy-ocean.surge.sh
  staging:
    branch: twilio
    commands:
      - npm install -g surge
      - surge ./map raspy-ocean.surge.sh
      - surge ./rider/www legal-stocking.surge.sh
#      - surge ./reporter/ odd-honey.surge.sh

